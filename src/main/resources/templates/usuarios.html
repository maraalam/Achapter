<!DOCTYPE html>
<html class="h-100" xmlns:th="http://www.thymeleaf.org">

<head>
    <th:block th:replace="fragments/head :: header" />
    <link rel="stylesheet" th:href="@{/css/profiles.css}" href="css/profiles.css" type="text/css" />
    <title>Usuarios</title>
</head>

<body class="d-flex flex-column h-100">
    <header th:replace="fragments/nav.html :: nav"></header>
    <main class="flex-shrink-0">

    <div class="container">
        <div class="row">


               
            <!--Columna resultados-->          
             <div class="products-box">
                <section>
                    <div class="input-group mb-n2 border rounded-pill">
                        <input id="search-text" placeholder="Búsqueda avanzada" aria-describedby="button-addon3" class="form-control bg-none border-0 search-advanced">
                        <div class="input-group-append border-0">
                        <button onclick="buscarUsuario()" id="button-addon3" type="button" class="btn btn-link text-success"><i class="fa fa-search"></i></button>
                        </div>
                    </div>
                </section>

                <!-- RESULTADOS DE LA BÚSQUEDA  -->
                <div class="products-box" >
                    <!---
                    <div th:if="${following!=null}">
                        <div th:text="${#lists.size(following)}">a</div>
                        <div  th:each="u: ${following}">
                            <div th:text="${u.username}" >a </div>
                        </div>
                    </div>
                    <div  th:each="u: ${following}">
                        <div th:text="${u.username}" >a </div>
                    </div>
                -->
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="title-all ">
                                    <h4>Resultados</h4>
                                </div>
                            </div>
                        </div>
                        
                        
                        <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-xl-4 gutters-sm  " >
                            <div  class="col mb-3 list-usuarios"  th:each="u: ${usuarios}">
                                <div class="card">
                                    <img  th:src="@{/img/bannerUser.png}" src="/img/bannerUser.png"   alt="Cover" class="card-img-top">
                                    <div class="card-body text-center">
                                        <a th:href="@{/user/__${u.id}__}" href="/user"  >
                                            <img 
                                            th:src="@{/user/{id}/pic(id=${u.id})}" src="https://bootdey.com/img/Content/avatar/avatar7.png" 
                                            style="width:100px; height:100px;margin-top:-200px" alt="User" class="img-fluid img-thumbnail rounded-circle border-0 mb-3">
                                        </a>
                                        <div style="margin-top:-40px" >
                                            <h5 th:text="${u.username}" class="card-title"   >John Doe</h5>
                                            <p th:text="|${u.firstName} ${u.lastName}|"  class="text-secondary mb-1"> Ana Perez</p>
                                            <p th:text="${u.about}"  class="text-muted font-size-sm"> Hola</p>
                                        </div>
                                    </div>
                                    <div class="card-footer">
                                        <div th:if="${#lists.size(following)!=0 }">
                                            <button th:if="${session.u.id != u.id and not #lists.contains(following, u) }" id="addF" class="btn btn-light btn-sm bg-white has-icon btn-block" type="button">Follow</button>
                                            <p th:if="${session.u.id != u.id and #lists.contains(following, u) }" class="btn btn-light btn-sm bg-white has-icon btn-block" style="margin-left:100px; color: #5cca60; ">Followed</p>
                                            <button th:if="${session.u.id != u.id}" class="btn btn-light btn-sm bg-white has-icon ml-2" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg></button>
                                        
                                        </div>
                                        <div th:if="${#lists.size(following)==0}">
                                            <button th:if="${session.u.id != u.id  }" id="addF" class="btn btn-light btn-sm bg-white has-icon btn-block" type="button">Follow</button>
                                            <button th:if="${session.u.id != u.id}" class="btn btn-light btn-sm bg-white has-icon ml-2" type="button"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-message-circle"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"></path></svg></button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        
                        </div>

                    

                </div>
                
            </div>
        </div>
    </div>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.1/css/all.min.css"   integrity="sha256-2XFplPlrFClt0bIdPgpz8H7ojnk10H69xRqd9+uTShA=" crossorigin="anonymous" />
    
    <script th:inline="javascript">
        
        


        function buscarUsuario() {
            console.log("getting users...");
            var search = document.getElementById("search-text").value;
            var rows = document.getElementsByClassName("list-usuarios");

            for(let r of rows){
                let username = r.getElementsByClassName("card-title")[0].innerHTML;
                let name = r.getElementsByClassName("text-secondary")[0].innerHTML;
                console.log(search + name);
                if (search === ""){
                    r.style.display = "block";
                }
                else if(username.toLowerCase().search(search.toLowerCase())!=-1)
                    r.style.display = "block";
                else if(name.toLowerCase().search(search.toLowerCase())!=-1)
                    r.style.display = "block";
                else{
                    r.style.display = "none";
                }
               
            }
        }

        let b = document.getElementById("addF");
        b.addEventListener('click', (e) => {
            if(b.innerHTML==="Follow"){
            e.preventDefault();
            let request = {usernameFollowed: "", usernameFollowing: ""};
            var card = b.parentNode.parentNode.parentNode;
            request.usernameFollowed  =card.getElementsByClassName("card-title")[0].innerHTML;
            request.usernameFollowing  = /*[[${session.u.username}]]*/ 'defaultanyvalue';

            go('addFollow', 'POST', request )
            .then(d => console.log("happy", d))
            .catch(e => console.log("sad", e))
      
            const para = document.createElement("p");
            para.innerText = "Following";
            para.style="margin-left:100px; color: #5cca60; ";
            para.class= "btn btn-light btn-sm bg-white has-icon btn-block";
            b.parentNode.parentNode.appendChild(para);
            b.parentNode.removeChild(b);
            }
        })
        /*
        function addFollow() {
            let card = this.
            console.log("follow new user...");
            var search = document.getElementById("search-text").value;
            var rows = document.getElementsByClassName("list-usuarios");

            for(let r of rows){
                let username = r.getElementsByClassName("card-title")[0].innerHTML;
                let name = r.getElementsByClassName("text-secondary")[0].innerHTML;
                console.log(search + name);
                if (search === ""){
                    r.style.display = "block";
                }
                else if(username.toLowerCase().search(search.toLowerCase())!=-1)
                    r.style.display = "block";
                else if(name.toLowerCase().search(search.toLowerCase())!=-1)
                    r.style.display = "block";
                else{
                    r.style.display = "none";
                }
               
            }
        }
*/

    </script>
    </main>

    <th:block th:replace="fragments/footer.html :: footer" />
</body>

</html>